<form class="bs-component"
      id="episodeDetail"
      name="episodeDetail"
      ng-submit="ctrl.updateAndClose()"
      novalidate>

  <div class="modal-header">
    <h1 ng-bind="ctrl.series.title"></h1>
  </div>

  <div class="modal-body clearfix">

    <!-- Top Group -->
    <div class="form-group col-lg-12">

      <!-- Episode Image -->
      <div class="form-group col-lg-6">
        <img class="img-rounded"
             ng-src="{{ctrl.episode.imageResolved}}"
             width="100%"/>
      </div>

      <div class="form-group col-lg-6">

        <!-- Title -->
        <div class="row">
          <div class="col-lg-12">
            <h2 ng-bind="ctrl.episode.title"></h2>
          </div>
        </div>

        <!-- Episode Number -->
        <div class="row">
          <div class="col-lg-12">
            <h4>
              <span>Season</span>
              <strong><span ng-bind="ctrl.episode.season"></span></strong>
              <span> - Episode</span>
              <strong><span ng-bind="ctrl.episode.episode_number"></span></strong>
            </h4>
          </div>
        </div>

        <!-- Episode Summary -->
        <div class="row">
          <div class="col-lg-12">
            <span ng-bind="ctrl.episode.tvdb_overview"></span>
          </div>
        </div>

        <!-- Air Date (uses Bootstrap Switch - remember javascript snippet at bottom to activate!) -->
        <div class="row" ng-show="ctrl.LockService.isAdmin()" style="margin-top: 15px">
          <div class="col-lg-6">
            <label class="control-label" for="airDate">Aired</label>
            <div class="date">
              <input type="text"
                     id="airDate"
                     name="airDate"
                     class="darkInput form-control"
                     ng-model="ctrl.air_date">
            </div>
          </div>
        </div>

      </div>

    </div>


    <!-- WATCHED SECTION -->
    <div class="row">
      <div class="form-group col-lg-12 form-subsection"
           ng-class="ctrl.getSectionClass()">

        <div class="row">
          <div class="col-lg-12" style="text-align: center">
            <button type="button"
                    uib-btn-checkbox
                    class="btn btn-success btn-lg"
                    ng-model="ctrl.interfaceRating.watched"
                    ng-click="ctrl.changeWatched()">
              {{ctrl.watchButtonText()}}
            </button>
          </div>
        </div>

        <div class="row" style="margin-top: 15px" ng-show="ctrl.interfaceRating.watched">
          <div class="col-lg-12">


            <div class="row">

              <div class="col-lg-4">
                <label class="control-label" for="watchedDate">Watched On</label>
                <!-- Watch Date (uses Bootstrap Switch - remember javascript snippet at bottom to activate!) -->

                <div class="input-group">
                  <input type="text"
                         id="watchedDate"
                         name="watchedDate"
                         class="darkInput form-control input-lg date"
                         ng-model="ctrl.watched_date">
                  <span class="input-group-btn">
                    <input type="button"
                           class="btn btn-default btn-lg"
                           value="Clear"
                           ng-disabled="!ctrl.watched_date"
                           ng-click="ctrl.clearWatchedDate()">
                  </span>
                </div>
              </div>

              <!-- Rating -->
              <div class="col-lg-3" ng-hide="ctrl.readOnly" ng-show="ctrl.interfaceRating.watched">
                <label class="control-label" for="ratingValue">Rating</label>
                <input type="number"
                       class="darkInput form-control input-lg"
                       id="ratingValue"
                       name="ratingValue"
                       ng-required="false"
                       ng-disabled="ctrl.skipRating"
                       min="1"
                       max="100"
                       ng-model="ctrl.interfaceRating.rating_value"
                       ng-change="ctrl.onRatingChange()"/>
              </div>

            </div>

            <div class="row" ng-show="!ctrl.firstUnwatched">
              <!-- All Past  -->
              <div class="form-group col-lg-1">
                <div>
                  <input type="checkbox"
                         checked
                         class="form-control"
                         ng-model="ctrl.allPastEpisodes">
                </div>
              </div>

              <div class="form-group col-lg-5 form-text">
                <span>Mark this episode watched with above date, and all previous episodes as watched with no date.</span>
              </div>

            </div>

            <div class="row">

              <div class="col-lg-12" ng-show="ctrl.interfaceRating.rating_pending">
                <div class="col-lg-1">
                  <input type="checkbox"
                         id="skipRating"
                         checked
                         class="form-control"
                         ng-model="ctrl.skipRating"
                         ng-change="ctrl.onSkipRatingChange()">
                </div>
                <div class="col-lg-11" style="vertical-align: middle">
                  Skip rating for this episode and clear pending status.
                </div>
              </div>

            </div>

            <div class="row">

              <!-- Review -->
              <div class="form-group col-lg-12" ng-show="ctrl.interfaceRating.watched" ng-hide="ctrl.readOnly">

                <label class="control-label" for="review">Review</label>
                <textarea
                    class="darkInput form-control"
                    id="review"
                    name="review"
                    ng-disabled="ctrl.skipRating"
                    rows="5"
                    ng-model-options="{ updateOn: 'blur' }"
                    ng-required="false"
                    ng-model="ctrl.interfaceRating.review"></textarea>

              </div>

            </div>

            <div class="row">

              <!-- Previous Episodes -->
              <div class="form-group col-lg-12" ng-show="ctrl.interfaceRating.watched" ng-hide="ctrl.readOnly">
                <h3>Previous Episodes</h3>
                <table class="table table-striped table-hover ">
                  <thead>
                  <th>Episode</th>
                  <th>Title</th>
                  <th>Date</th>
                  <th>Rating</th>
                  </thead>
                  <tr data-ng-repeat="episode in ctrl.previousEpisodes">
                    <td ng-bind="episode.episode_number"></td>
                    <td ng-bind="episode.title" class="episodeDescription"></td>
                    <td ng-bind="episode.air_time|date:ctrl.getDateFormat(episode.air_time):'America/Los_Angeles'"></td>
                    <td ng-style="episode.colorStyle()" width="70">
              <span ng-bind="episode.rating_value"
                    ng-show="!ctrl.shouldShowRate(episode)"></span>
                    </td>
                  </tr>
                </table>
              </div>

            </div>
          </div>


        </div>




      </div>

    </div>



    <div class="form-group col-lg-12">

      <!-- TVDB Info -->
      <div class="form-group col-lg-6" ng-show="ctrl.episode.tvdb_episode_id !== null">

        <!-- Director -->
        <div ng-show="ctrl.episode.tvdb_director !== null">
          <h3>Director</h3>
          <span ng-bind="ctrl.episode.tvdb_director"></span>
        </div>

        <!-- Writer -->
        <div ng-show="ctrl.episode.tvdb_writer !== null">
          <h3>Writer</h3>
          <span ng-bind="ctrl.episode.tvdb_writer"></span>
        </div>

        <!-- Production Code -->
        <div ng-show="ctrl.episode.tvdb_production_code !== null">
          <h3>Production Code</h3>
          <span ng-bind="ctrl.episode.tvdb_production_code"></span>
        </div>

        <!-- Rating -->
        <div ng-show="ctrl.episode.tvdb_rating !== null && ctrl.episode.tvdb_rating > 0.0">
          <h3>TVDB Rating</h3>
          <span ng-bind="ctrl.episode.tvdb_rating"></span>
        </div>

      </div>

      <!-- TiVo Info-->
      <div class="form-group col-lg-6" ng-show="ctrl.episode.on_tivo">


        <!-- Station -->
        <div ng-show="ctrl.episode.tivo_station !== null">
          <h3>Station</h3>
          <span ng-bind="ctrl.episode.tivo_station"></span>
        </div>

        <!-- Channel -->
        <div ng-show="ctrl.episode.tivo_channel !== null">
          <h3>Channel</h3>
          <span ng-bind="ctrl.episode.tivo_channel"></span>
        </div>

        <!-- Rating -->
        <div ng-show="ctrl.episode.tivo_rating !== null">
          <h3>Rating</h3>
          <span ng-bind="ctrl.episode.tivo_rating"></span>
        </div>

      </div>


    </div>

  </div>


  <div class="modal-footer">
    <input class="btn btn-primary"
           type="submit"
           value="Submit"
           ng-show="ctrl.LockService.isUser()"
           ng-disabled="episodeDetail.$invalid || !ctrl.LockService.isAuthenticated">
    <input class="btn btn-default"
           type="button"
           value="Cancel"
           ng-click="ctrl.cancel()">
  </div>

</form>

<script>
  $(document).ready(function()  {
    $('#watchedDate').datepicker({
      todayBtn: "linked",
      clearBtn: false,
      daysOfWeekHighlighted: "0,6",
      autoclose: true,
      todayHighlight: true
    });
    $('#airDate').datepicker({
      todayBtn: "linked",
      clearBtn: true,
      daysOfWeekHighlighted: "0,6",
      autoclose: true,
      todayHighlight: true
    });
  });
</script>

